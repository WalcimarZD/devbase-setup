## 2024-03-24 - Command Injection Vulnerability in PKM Commands
**Vulnerability:** Found usage of `subprocess.run(..., shell=True)` with user-influenced file paths in `src/devbase/commands/pkm.py` (specifically in `journal` and `icebox` commands). This pattern is susceptible to Command Injection if a malicious file name (e.g., containing `; rm -rf /`) is processed.
**Learning:** Even when operating on `pathlib.Path` objects, converting them to strings and passing them to `shell=True` exposes the application to shell expansion risks. The safety of `Path` objects does not extend to their string representation in a shell context.
**Prevention:** Always use `subprocess.run(["command", "arg1", ...], shell=False)` (passing arguments as a list). This bypasses the shell entirely and treats arguments as data, not executable code. This pattern was applied to `pkm.py` and a regression test `tests/test_pkm_security.py` was added to enforce secure subprocess calls.
