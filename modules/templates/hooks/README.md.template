# Git Hooks (PowerShell)

> Hooks para validaÃ§Ã£o automÃ¡tica de commits e cÃ³digo, escritos em PowerShell para portabilidade cross-platform.

## O que sÃ£o Git Hooks?

Git Hooks sÃ£o scripts que o Git executa automaticamente em certos eventos (commit, push, merge, etc.). Eles permitem automatizar validaÃ§Ãµes e garantir qualidade do cÃ³digo.

**Por que usar hooks?**
- âœ… ValidaÃ§Ã£o automÃ¡tica antes de commits
- âœ… PadronizaÃ§Ã£o de mensagens de commit
- âœ… DetecÃ§Ã£o de credenciais/secrets antes de vazar
- âœ… ExecuÃ§Ã£o de testes antes de push

## ğŸ”§ InstalaÃ§Ã£o

O mÃ©todo mais robusto Ã© usar o script de instalaÃ§Ã£o:

```powershell
# Instala hooks no repositÃ³rio atual
./install-hooks.ps1

# Ou via CLI do DevBase
devbase install-hooks
```

Isso configura `core.hooksPath` para apontar para a pasta compartilhada de hooks, garantindo que todos os repos usem os mesmos padrÃµes.

## ğŸ“‹ Hooks DisponÃ­veis

### pre-commit

Executado **antes** de cada commit. Valida:

- ğŸ¨ **FormataÃ§Ã£o** - Verifica se cÃ³digo estÃ¡ formatado (prettier, eslint, black)
- ğŸ”‘ **Secrets** - Detecta credenciais/tokens hardcoded
- ğŸ“ **Lint** - Erros de sintaxe e style

```powershell
# O hook roda automaticamente, mas vocÃª pode testar:
.\.git\hooks\pre-commit
```

### commit-msg

Valida a **mensagem de commit** seguindo [Conventional Commits](https://www.conventionalcommits.org/):

**Formato:** `<type>(<scope>): <description>`

```bash
# âœ… VÃ¡lidos
feat(auth): add OAuth2 login
fix(cart): resolve quantity validation bug
docs: update API documentation

# âŒ InvÃ¡lidos
"fixed bug"           # Sem tipo
"FEAT: Add feature"   # Tipo em maiÃºsculo
"feat add feature"    # Falta dois pontos
```

### pre-push

Executado **antes** de push para remoto. Verifica:

- ğŸ§ª **Testes** - Executa suite de testes
- ğŸ›¡ï¸ **Branch protegida** - Previne push direto para main/master
- ğŸ“Š **Coverage** - (opcional) Valida cobertura mÃ­nima

## ğŸ”§ ConfiguraÃ§Ã£o

Os hooks podem ser configurados via variÃ¡veis de ambiente ou arquivo `.devbase.json`:

```json
{
  "hooks": {
    "pre-commit": {
      "enabled": true,
      "formatters": ["prettier", "eslint"],
      "detectSecrets": true
    },
    "commit-msg": {
      "enabled": true,
      "allowedTypes": ["feat", "fix", "docs", "style", "refactor", "test", "chore"]
    },
    "pre-push": {
      "enabled": true,
      "runTests": true,
      "protectedBranches": ["main", "master", "develop"]
    }
  }
}
```

## ğŸš« Bypass (usar com cautela!)

Em situaÃ§Ãµes emergenciais, vocÃª pode pular hooks:

```bash
# Pular pre-commit e commit-msg
git commit --no-verify -m "emergency fix"

# Pular pre-push
git push --no-verify
```

âš ï¸ **Aviso:** Use apenas em emergÃªncias. Bypasses frequentes indicam que os hooks precisam ser ajustados.

## ğŸ” Troubleshooting

**Hooks nÃ£o executam?**
```powershell
# Verificar se core.hooksPath estÃ¡ configurado
git config core.hooksPath

# Reinstalar hooks
./install-hooks.ps1 -Force
```

**Erro de permissÃ£o (Linux/Mac)?**
```bash
chmod +x .git/hooks/*
```

**Hook estÃ¡ lento?**
- Use cache para formatters (prettier --cache)
- Execute lint apenas em arquivos staged (lint-staged)

## ğŸ“š ReferÃªncias

- [Conventional Commits](https://www.conventionalcommits.org/)
- [Git Hooks Documentation](https://git-scm.com/docs/githooks)
- [Husky](https://typicode.github.io/husky/) - Popular para projetos Node.js
