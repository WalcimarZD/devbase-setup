<#
.SYNOPSIS
  DevBase Observability Exports - generate weeknotes and brag-doc templates.

.DESCRIPTION
  Subcommands:
    weeknotes - Generate a weeknotes template (Markdown)
    brag-doc  - Generate a brag document template

  Can be used standalone or combined with telemetry.ps1 for data population.

.NOTES
  Author: DevBase
  Version: 1.0.0
#>

[CmdletBinding()]
param(
    [Parameter(Mandatory = $true, Position = 0)]
    [ValidateSet('weeknotes', 'brag-doc')]
    [string]$Command,

    [string]$OutputPath,
    [string]$Author,
    [switch]$Help
)

function Show-Usage {
    Write-Host "Usage: observability.ps1 <weeknotes|brag-doc> [options]"
    Write-Host "  weeknotes [-OutputPath <path>] [-Author <name>] - Generate weeknotes template"
    Write-Host "  brag-doc  [-OutputPath <path>] [-Author <name>] - Generate brag-doc template"
}

if ($Help) { Show-Usage; exit 0 }

$authorName = if ($Author) { $Author } else { $env:USERNAME }

function Generate-Weeknotes {
    param([string]$Out)
    $now = Get-Date
    $weekStart = $now.AddDays(-([int]$now.DayOfWeek)).ToString('yyyy-MM-dd')
    $weekEnd = $now.ToString('yyyy-MM-dd')

    $md = @"
# Weeknotes: $weekStart to $weekEnd

Author: $authorName  
Generated: $($now.ToString('yyyy-MM-dd HH:mm'))

---

## ğŸ¯ Goals this week

- [ ] Goal 1
- [ ] Goal 2
- [ ] Goal 3

## âœ… Completed

- Item 1
- Item 2

## ğŸš§ In Progress

- Work in progress item

## ğŸ”® Next week

- Planned item

## ğŸ“ Notes

_Add any additional notes, learnings, or reflections here._

## ğŸ“Š Metrics

| Metric | Value |
|--------|-------|
| Commits | 0 |
| PRs merged | 0 |
| Issues closed | 0 |

---

_Generated by DevBase Observability CLI_
"@

    if ($Out) {
        $md | Out-File -FilePath $Out -Encoding UTF8
        Write-Host "Weeknotes written to: $Out"
    }
    else {
        Write-Output $md
    }
}

function Generate-BragDoc {
    param([string]$Out)
    $now = Get-Date
    $year = $now.Year
    $quarter = [math]::Ceiling($now.Month / 3)

    $md = @"
# Brag Document - Q$quarter $year

Author: $authorName  
Generated: $($now.ToString('yyyy-MM-dd HH:mm'))

---

## ğŸ† Key Accomplishments

### Project: [Project Name]

**Impact**: _Describe the business or technical impact_

- Accomplishment 1
- Accomplishment 2

### Technical Achievements

- Achievement 1
- Achievement 2

## ğŸ“ˆ Metrics & Numbers

| Metric | Before | After | Improvement |
|--------|--------|-------|-------------|
| Metric 1 | X | Y | Z% |

## ğŸ“ Skills Developed

- Skill 1: _Brief description_
- Skill 2: _Brief description_

## ğŸ‘¥ Collaboration & Leadership

- Mentored team member on X
- Led initiative for Y
- Contributed to Z

## ğŸ”§ Tools & Processes Improved

- Improvement 1
- Improvement 2

## ğŸ“š Learning & Growth

- Completed course/certification
- Read book/article
- Attended conference/meetup

## ğŸ¯ Goals for Next Quarter

1. Goal 1
2. Goal 2
3. Goal 3

---

_Generated by DevBase Observability CLI_
"@

    if ($Out) {
        $md | Out-File -FilePath $Out -Encoding UTF8
        Write-Host "Brag doc written to: $Out"
    }
    else {
        Write-Output $md
    }
}

switch ($Command) {
    'weeknotes' {
        Generate-Weeknotes -Out $OutputPath
    }
    'brag-doc' {
        Generate-BragDoc -Out $OutputPath
    }
    Default {
        Show-Usage
        exit 1
    }
}
